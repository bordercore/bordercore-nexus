{% extends "base.html" %}
{% load vite_tags %}

{% block extra_head %}
    <style>
        /* Markdown editor styles for drill question edit */
        .markdown-editor {
            display: flex;
            flex-direction: column;
            border: 1px solid var(--surface1);
            border-radius: 0.25rem;
            background-color: var(--form-bg);
            color: var(--text1);
        }
        .markdown-editor.drag-over {
            border-color: var(--form-border-color-hover);
        }
        .markdown-editor:focus-within {
            border-color: var(--form-border-color-hover);
        }
        .markdown-toolbar {
            flex-shrink: 0;
            background-color: var(--form-bg);
        }
        .markdown-toolbar-item {
            padding: 0.5rem 0.625rem;
            border: none;
            background: transparent;
            color: var(--text1);
            cursor: pointer;
        }
        .markdown-toolbar-item:hover {
            color: var(--form-bg);
            background-color: var(--text1);
        }
        .toolbar-divider {
            width: 1px;
            height: 20px;
            margin: 0 0.25rem;
            background: var(--border-color);
        }
        .markdown-textarea {
            flex-grow: 1;
            border: none;
            border-radius: 0 0 0.25rem 0.25rem;
            background-color: var(--form-bg);
            color: var(--text1);
            min-height: 200px;
            resize: vertical;
        }
        .markdown-textarea:focus {
            background-color: var(--form-bg-focus);
            caret-color: var(--text4);
            color: var(--text4);
            box-shadow: none;
        }
        /* Card title styles matching Pinned Tags */
        .card-title,
        .card-title-large {
            color: var(--text4);
            font-size: 1.5rem;
        }
    </style>
{% endblock %}

{% block title %} Drill {% endblock %}

{% block nav %}
    <div class="me-auto align-self-center mb-3">
        <ul class="breadcrumb mb-0 pt-0 pb-0">
            <li class="breadcrumb-item"> <a href="{% url 'drill:list' %}">Drill</a> </li>
            <li class="breadcrumb-item active">{{ action }} Question</li>
        </ul>
    </div>
{% endblock %}

{% block content %}
    <div
        id="react-root"
        data-initial-question="{{ object.question|default:form.question.value|default_if_none:''|escapejs }}"
        data-initial-answer="{{ object.answer|default:form.answer.value|default_if_none:''|escapejs }}"
        data-is-reversible="{{ form.is_reversible.value|yesno:'true,false' }}"
        data-object-uuid="{{ object.uuid|default:'' }}"
        data-action="{{ action }}"
        data-csrf-token="{{ csrf_token }}"
        data-submit-url="{{ request.path }}"
        data-delete-url="{% if object.uuid %}{% url 'drill:delete' object.uuid %}{% endif %}"
        data-cancel-url="{% if request.GET.return_url %}{{ request.GET.return_url }}{% else %}{% url 'drill:list' %}{% endif %}"
        data-return-url="{% firstof request.GET.return_url request.POST.return_url '' %}"
        data-tag-search-url="{% url 'tag:search' %}?query="
        data-related-objects-url="{% url 'drill:related_objects' '00000000-0000-0000-0000-000000000000' %}"
        data-new-object-url="{% url 'blob:add_related_object' %}"
        data-remove-object-url="{% url 'blob:remove_related_object' %}"
        data-sort-related-objects-url="{% url 'blob:sort_related_objects' %}"
        data-edit-related-object-note-url="{% url 'blob:update_related_object_note' %}"
        data-search-names-url="{% url 'search:search_names' %}"
    ></div>

    {{ tags|json_script:"initial-tags" }}

    <script type="application/json" id="recent-tags">
    [{% for tag in recent_tags %}{"name": "{{ tag.name|escapejs }}"}{% if not forloop.last %},{% endif %}{% endfor %}]
    </script>

    <script type="application/json" id="form-errors">
    {
        {% if form.question.errors %}"question": [{% for error in form.question.errors %}"{{ error|escapejs }}"{% if not forloop.last %},{% endif %}{% endfor %}],{% endif %}
        {% if form.answer.errors %}"answer": [{% for error in form.answer.errors %}"{{ error|escapejs }}"{% if not forloop.last %},{% endif %}{% endfor %}],{% endif %}
        {% if form.tags.errors %}"tags": [{% for error in form.tags.errors %}"{{ error|escapejs }}"{% if not forloop.last %},{% endif %}{% endfor %}]{% endif %}
    }
    </script>
{% endblock %}

{% block javascript_bundles %}
    {{ block.super }}
    {% vite_asset "dist/js/drill-question-edit" %}
{% endblock %}
