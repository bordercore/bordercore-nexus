{% extends "base.html" %}
{% load vite_tags %}

{% block title %} Preferences {% endblock %}

{% block content %}

    <div id="react-root"
        data-form-action="{{ request.path }}"
        data-csrf-token="{{ csrf_token }}"
        data-tag-search-url="{% url 'tag:search' %}?doctype=drill&query="
        data-password-url="{% url 'accounts:password' %}"
        data-auth-token="{{ user.auth_token|default:'' }}"
        data-groups="{{ groups }}"
        data-sidebar-image="{{ object.sidebar_image|default:'' }}"
        data-background-image="{{ object.background_image|default:'' }}"
        data-eye-candy="{{ form.eye_candy.value|yesno:'true,false' }}"
        data-instagram-username="{{ instagram_username|default:'' }}"
        data-instagram-password="{{ instagram_password|default:'' }}"
    ></div>

    {{ drill_tags_muted|json_script:"initial-tags" }}

    <script id="formFields" type="application/json">
    [
        {% for field in form %}
        {
            "name": "{{ field.name }}",
            "label": "{{ field.label }}",
            "value": "{{ field.value|default:''|escapejs }}",
            "type": "{% if field.name == 'google_calendar' %}textarea{% else %}text{% endif %}",
            "widget": "{{ field.field.widget.input_type|default:'text' }}",
            "required": {% if field.field.required %}true{% else %}false{% endif %},
            "choices": [{% for choice in field.field.choices %}["{{ choice.0|escapejs }}", "{{ choice.1|escapejs }}"]{% if not forloop.last %}, {% endif %}{% endfor %}],
            "errors": [{% for error in field.errors %}"{{ error|escapejs }}"{% if not forloop.last %}, {% endif %}{% endfor %}]
        }{% if not forloop.last %},{% endif %}
        {% endfor %}
    ]
    </script>

{% endblock %}

{% block javascript_bundles %}
    {{ block.super }}
    {% vite_asset "dist/js/prefs" %}
{% endblock %}
