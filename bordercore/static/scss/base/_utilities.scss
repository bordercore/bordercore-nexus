// =============================================================================
// BASE: UTILITIES
// =============================================================================
// Helper classes for layout, text, transitions, and common patterns

// Eye candy effects
:root[eye-candy="True"] {
  --eye-candy: blur(1.56rem) brightness(170%);
}

:root[eye-candy="False"] {
  --eye-candy: none;
}

// Background glowing sphere
div.sphere {
  position: fixed;
  z-index: -1;
  width: 25rem;
  height: 25rem;
  background: radial-gradient(circle, var(--sphere-gradient-start) 0%, var(--sphere-gradient-end) 100%);
  border-radius: 50%;
  filter: var(--eye-candy);
  pointer-events: none;
}

// Layout utilities
.scroll-container {
  overflow: hidden scroll;
  width: 100%;
  height: 100%;
  scrollbar-gutter: stable;
}

.extend-block {
  flex-grow: 1;
}

.flex-even {
  flex: 1 1 0;
}

.flex-grow-last > div:last-child {
  flex-grow: 1;
}

.sticky-top {
  position: sticky;
  z-index: 1020;
  top: 0;
  padding-top: 0.5rem;
  padding-bottom: 0.5rem;
}

[hidden] {
  display: none !important;
}

.hidden {
  display: none;
}

// Width utilities
.w-20 {
  width: 20%;
}

.mw-50 {
  max-width: 50%;
}

.vh-50 {
  height: 50vh;
}

.vh-95 {
  height: 95vh;
}

// Text utilities
.text4 {
  color: var(--text4);
}

.text5 {
  color: var(--text5);
}

.text-name {
  font-weight: 600;
}

.text-value {
  color: var(--text2);
}

.text-emphasis {
  color: var(--text1) !important;
  font-weight: 600;
}

.text-notice {
  color: var(--text-notice);
}

.text-small {
  font-size: 0.875rem;
}

.text-secondary {
  color: var(--text2);
}

.z-index-positive {
  z-index: 1;
}

// CSS Transitions
.slide-fade-enter-active {
  transition: all 0.3s ease;
}

.slide-fade-leave-active {
  transition: all 0.3s cubic-bezier(1.0, 0.5, 0.8, 1.0);
}

.slide-fade-enter-from,
.slide-fade-leave-to {
  opacity: 0;
  transform: translateX(10px);
}

.fade-enter-active,
.fade-leave-active {
  transition: opacity 0.3s;
}

.fade-enter,
.fade-leave-to {
  opacity: 0;
}

// Messages
.message-error {
  padding: 1rem;
  margin-bottom: 1rem;
  background-color: var(--error-bg);
  border-radius: var(--border-radius1);
  color: var(--error-text);
}

.message-info {
  padding: 1rem;
  margin-bottom: 1rem;
  background-color: var(--info-bg);
  border-radius: var(--border-radius1);
  color: var(--info-text);
}

// Drag and drop
div.drag-target {
  padding: 2rem;
  text-align: center;
}

.drag-over {
  background-color: var(--hover-bg);
}

.node-draggable {
  cursor: grab;
}

.dragging {
  z-index: 999;
}

// Visual effects
.highlight-box {
  padding: 0.5rem;
  border: 1px solid var(--border-color);
  background-color: var(--surface3);
  border-radius: var(--border-radius1);
}

.notice-big {
  padding: 2rem;
  margin: 2rem 0;
  background-color: var(--surface2);
  border-radius: var(--border-radius1);
  color: var(--text1);
  font-size: 1.5rem;
  font-weight: 600;
  text-align: center;
}

.circle {
  display: flex;
  width: 2.5rem;
  height: 2.5rem;
  align-items: center;
  justify-content: center;
  background-color: var(--surface2);
  border-radius: 50%;
  color: var(--text1);
}

.icon-hover {
  transition: color 0.2s ease;

  svg {
    transition: filter 0.2s ease;
  }

  &:hover {
    color: var(--link-color);

    svg {
      filter: drop-shadow(0.12rem 0.12rem 0.62rem var(--text3)) drop-shadow(-0.12rem -0.12rem 0.62rem var(--text3));
    }
  }
}

.glow {
  &:hover {
    filter: drop-shadow(0 0 0.5rem var(--glow-color));
  }
}

%zoom {
  transition: transform 1s;

  &:hover {
    filter: drop-shadow(0.12rem 0.12rem 0.62rem var(--text3-transparent)) drop-shadow(-0.12rem -0.12rem 0.62rem var(--text3-transparent));
    transform: scale(1.1);
  }
}

.zoom {
  @extend %zoom;
}

.zoomable {
  cursor: zoom-in;

  @extend %zoom;
}

.icon-disabled {
  opacity: 0.4;
}

// Scrollable panels
.scrollable-panel-container {
  overflow: hidden;
}

.scrollable-panel {
  overflow: hidden auto;
}

.scrollable-panel-scrollbar-hover {
  overflow: hidden;
  scrollbar-gutter: stable;

  &:hover {
    overflow-y: auto;
  }

  &::-webkit-scrollbar {
    width: 0.5rem;
  }
}

// Divider line
hr.divider {
  height: 0.15rem;
  margin-top: 0.25rem;
  background-color: var(--surface7);
}

// Fader effect
.fader::after {
  position: absolute;
  right: 0;
  bottom: 0;
  left: 0;
  height: 3rem;
  background: linear-gradient(to bottom, transparent, var(--surface1));
  content: "";
  pointer-events: none;
}

// Column gutter utility
.pe-gutter {
  padding-right: var(--column-gutter) !important;
}

.ps-gutter {
  padding-left: var(--column-gutter) !important;
}

.mb-gutter {
  margin-bottom: var(--column-gutter) !important;
}

.me-gutter {
  margin-right: var(--column-gutter) !important;
}

.ms-gutter {
  margin-left: var(--column-gutter) !important;
}

.min-h-0 {
  min-height: 0;
}

// Show child element only on hover
.show-child-on-hover {
  .show-on-hover {
    opacity: 0;
    transition: opacity 0.2s ease;
  }

  &:hover .show-on-hover {
    opacity: 1;
  }
}

// Progress circle (SVG circular progress indicator)
.progress-circle {
  circle.circle-partial {
    stroke: var(--drill-progress-circle-partial);
    transform: rotate(-90deg);
    transform-origin: center;
  }

  circle.circle-full {
    stroke: var(--drill-progress-circle-full);
  }

  text {
    fill: var(--text4);
  }
}

// Favorite icon (heart)
.favorite {
  color: var(--favorite-color);
}

// Copy button for code blocks
// Button appears in upper-right corner on hover
// Order: base styles first, then less-specific hover, then more-specific parent hover
.code-block-wrapper {
  position: relative;
}

.copy-button {
  position: absolute;
  z-index: 2;
  top: 0.3em;
  right: 0.2em;
  padding: 0 0.5em;
  border: none;
  background: none;
  border-radius: 0.5em;
  color: #cfacd9;
  font-size: 0.8em;
  opacity: 0;
  text-shadow: 0 0 0.12rem #100c0f, 0 0 0.31rem #dc078e33, 0 0 0.62rem var(--text1);
  transition: opacity 0.3s ease-in-out;

  &:hover {
    filter: drop-shadow(0.12rem 0.12rem 0.62rem #f071c1) drop-shadow(-0.12rem -0.12rem 0.62rem #f071c1);
    opacity: 1;
  }

  &.console {
    right: 2.3em;
  }
}

.code-input:hover > .copy-button,
.code-block-wrapper:hover > .copy-button,
pre[class*="language-"]:hover > .copy-button {
  opacity: 1;
}

// Drill info card - disable hover effect on list items
.drill-info-card {
  li:hover {
    background-color: transparent !important;
  }
}

// Python Console styles
.code-header {
  font-size: 1.5rem;
}

.code-input {
  position: relative;
  top: 0;
  left: 0;
  display: block;
  width: calc(100% - 16px);
  height: 50vh;
  padding: 8px;
  margin: 8px;
  caret-color: darkgrey;
  font-family: monospace;
  font-size: 15pt;
  line-height: 20pt;
  tab-size: 2;
  white-space: pre;

  .code-block-wrapper {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
  }
}

// Python Console fill layout: when inside .python-console-root, editor flexes to fill
.python-console-root {
  .code-header {
    flex-shrink: 0;
  }

  #output-container {
    flex-shrink: 0;
  }

  .code-input {
    height: auto !important;
    min-height: 0;
    flex: 1 1 0;
  }
}

.code-input textarea,
.code-input pre,
.code-input pre * {
  font-family: inherit !important;
  font-size: inherit !important;
  line-height: inherit !important;
  tab-size: inherit !important;
}

.code-input textarea,
.code-input pre {
  position: absolute;
  top: 0;
  left: 0;
  overflow: auto !important;
  overflow-wrap: normal;
  white-space: inherit;
  word-break: normal;
  word-spacing: normal;
}

.code-input textarea {
  z-index: 1;
  background: transparent;
  caret-color: inherit !important;
  color: transparent;
  outline: none !important;
  resize: none;
}

.code-input pre {
  z-index: 0;
}

.code-input textarea,
.code-input:not(.code-input-pre-element-styled) pre code,
.code-input.code-input-pre-element-styled pre {
  width: calc(100% - (var(--padding, 16px) * 2)) !important;
  height: calc(100% - (var(--padding, 16px) * 2)) !important;
  padding: var(--padding, 16px) !important;
  border: 0;
  margin: 0 !important;
}

.code-input:not(.code-input-pre-element-styled) pre,
.code-input.code-input-pre-element-styled pre code {
  overflow: auto !important;
  width: 100% !important;
  height: 100% !important;
  padding: 0 !important;
  border: 0 !important;
  margin: 0 !important;
}

#code-output {
  font-family: monospace;
  font-size: 1.5rem;
  white-space: pre-wrap;
}

.python-error {
  color: #f00;
}

// Link utilities
.link-inherit {
  color: inherit;

  &:hover {
    color: inherit;
  }
}

// Icon clickable style
.icon-clickable {
  display: inline-block;
  cursor: pointer;
}

// Cursor utilities
.cursor-pointer {
  cursor: pointer;
}

.cursor-wait {
  cursor: wait;
}

// Z-index utilities
.z-index-1 {
  z-index: 1;
}

.z-index-1000 {
  z-index: 1000;
}

.z-index-10000 {
  z-index: 10000;
}
